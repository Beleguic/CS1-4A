<!DOCTYPE html>
<html lang="{{ app.request.locale }}" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}PlumbPay{% endblock %} - Gestion Professionnelle de Plomberie</title>
    <link rel="icon" href="/plombier.png" type="image/png">
    {% block stylesheets %}
        {{ encore_entry_link_tags('app') }}
    {% endblock %}
    {% block javascripts %}
            <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
        {{ encore_entry_script_tags('app') }}
        <script>
            // Simple navigation detection for icon refresh
            window.addEventListener('pageshow', function(event) {
                if (event.persisted && window.refreshIcons) {
                    // Page was restored from cache (back/forward navigation)
                    window.refreshIcons();
                }
            });
        </script>
    {% endblock %}
</head>

<body class="h-full bg-bgBody-400 dark:bg-bgBody-800 text-TextColor-400 dark:text-TextColor-800 font-sans">
    {% include '_composants/_sidebar.html.twig' with {'type': 'base'} %}
    <div class="flex-1 sm:ml-64 relative">
        {% include '_composants/_header.html.twig' with {'type': 'base'} %}
        <main class="min-h-screen">
            <div class="p-6 m-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50">
                {% for type, flashMessages in app.flashes %}
                    {% for message in flashMessages %}
                        <div class="rounded-lg p-4 mb-4 border-l-4 backdrop-blur-sm 
                                    {% if type == 'success' %}bg-green-50/90 dark:bg-green-900/20 border-l-green-500 text-green-800 dark:text-green-400
                                    {% elseif type == 'error' %}bg-red-50/90 dark:bg-red-900/20 border-l-red-500 text-red-800 dark:text-red-400
                                    {% elseif type == 'warning' %}bg-yellow-50/90 dark:bg-yellow-900/20 border-l-yellow-500 text-yellow-800 dark:text-yellow-400
                                    {% else %}bg-blue-50/90 dark:bg-blue-900/20 border-l-blue-500 text-blue-800 dark:text-blue-400{% endif %}">
                            <div class="flex items-center">
                                {% if type == 'success' %}
                                    {{ include('_composants/_lucide_icon.html.twig', { name: 'check-circle', class: 'mr-3 text-green-600 dark:text-green-400' }) }}
                                {% elseif type == 'error' %}
                                    {{ include('_composants/_lucide_icon.html.twig', { name: 'alert-circle', class: 'mr-3 text-red-600 dark:text-red-400' }) }}
                                {% elseif type == 'warning' %}
                                    {{ include('_composants/_lucide_icon.html.twig', { name: 'alert-triangle', class: 'mr-3 text-yellow-600 dark:text-yellow-400' }) }}
                                {% else %}
                                    {{ include('_composants/_lucide_icon.html.twig', { name: 'info', class: 'mr-3 text-blue-600 dark:text-blue-400' }) }}
                                {% endif %}
                                <span class="font-medium">{{ message|raw }}</span>
                            </div>
                        </div>
                    {% endfor %}
                {% endfor %}

                {% block body %}{% endblock %}
            </div>
        </main>
        {% include '_composants/_footer.html.twig' with {'type': 'base'} %}
    </div>

    <div x-data="{ sidebarOpen: false }" x-on:toggle-sidebar.window="sidebarOpen = !sidebarOpen" class="sm:hidden">
        <!-- Mobile Sidebar Overlay -->
        <div x-show="sidebarOpen" 
             x-transition:enter="transition-opacity ease-linear duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition-opacity ease-linear duration-300"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 bg-black/50 backdrop-blur-sm z-40"
             @click="sidebarOpen = false"></div>

        <!-- Mobile Sidebar -->
        <aside x-show="sidebarOpen"
               x-transition:enter="transition ease-in-out duration-300 transform"
               x-transition:enter-start="-translate-x-full"
               x-transition:enter-end="translate-x-0"
               x-transition:leave="transition ease-in-out duration-300 transform"
               x-transition:leave-start="translate-x-0"
               x-transition:leave-end="-translate-x-full"
               class="fixed inset-y-0 left-0 w-64 z-50 flex flex-col bg-linear-to-b from-slate-800 to-slate-900 shadow-2xl border-r border-slate-700">
            
            <div class="flex items-center justify-between p-6 border-b border-slate-700">
                <img src="/plumbpaylogo-removebg-preview.png" 
                     class="w-20 h-20 drop-shadow-lg hover:scale-105 transition-transform duration-300" 
                     alt="PlumbPay Logo">
                <button @click="sidebarOpen = false" 
                        class="text-white/80 hover:text-white p-2 rounded-lg hover:bg-white/10 transition-all duration-200">
                    {{ include('_composants/_lucide_icon.html.twig', { name: 'x', class: 'w-5 h-5' }) }}
                </button>
            </div>
            
            <nav class="flex-1 px-4 py-6 space-y-1">
                <a href="{{ path('front_default_index') }}" 
                   @click="sidebarOpen = false"
                   class="flex items-center px-4 py-3 text-white/90 hover:text-white font-medium rounded-xl transition-all duration-200 hover:bg-white/10 border border-transparent hover:border-white/20">
                    {{ include('_composants/_lucide_icon.html.twig', { name: 'home', class: 'mr-3 w-5 h-5' }) }}
                    <span>Home</span>
                </a>
                
                {% if app.user %}
                    <a href="{{ path('front_app_devis_index') }}" 
                       @click="sidebarOpen = false"
                       class="flex items-center px-4 py-3 text-white/90 hover:text-white font-medium rounded-xl transition-all duration-200 hover:bg-white/10 border border-transparent hover:border-white/20">
                        {{ include('_composants/_lucide_icon.html.twig', { name: 'file-text', class: 'mr-3 w-5 h-5' }) }}
                        <span>Quotes</span>
                    </a>
                    
                    <a href="{{ path('front_app_facture_index') }}" 
                       @click="sidebarOpen = false"
                       class="flex items-center px-4 py-3 text-white/90 hover:text-white font-medium rounded-xl transition-all duration-200 hover:bg-white/10 border border-transparent hover:border-white/20">
                        {{ include('_composants/_lucide_icon.html.twig', { name: 'receipt', class: 'mr-3 w-5 h-5' }) }}
                        <span>Invoices</span>
                    </a>
                    
                    <a href="{{ path('front_app_category_index') }}" 
                       @click="sidebarOpen = false"
                       class="flex items-center px-4 py-3 text-white/90 hover:text-white font-medium rounded-xl transition-all duration-200 hover:bg-white/10 border border-transparent hover:border-white/20">
                        {{ include('_composants/_lucide_icon.html.twig', { name: 'tags', class: 'mr-3 w-5 h-5' }) }}
                        <span>Categories</span>
                    </a>
                {% endif %}
            </nav>
        </aside>
    </div>
</body>
</html>